name: Deploy to VPS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      # ✅ PATCH: Passage à Rsync (via easingthemes/ssh-deploy)
      # C'est le standard industriel pour déployer sans interruption.
      - name: Deploy to VPS via Rsync
        uses: easingthemes/ssh-deploy@main
        env:
          # Tes secrets restent identiques
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          REMOTE_HOST: ${{ secrets.VPS_IP }}
          REMOTE_USER: ${{ secrets.VPS_USER }}
          
          # Dossier source (la racine du repo)
          SOURCE: "/"
          # Dossier destination sur le serveur
          TARGET: "/var/www/ShenzConnect"
          
          # Fichiers à ignorer (ne pas uploader)
          EXCLUDE: "/.git/, /.github/, /README.md"
          
          # ⚙️ ARGS EXPLICATION :
          # -rltgoDzvO : Archive, compression, verbeux (standard rsync)
          # --delete   : Supprime sur le VPS les fichiers qui n'existent plus dans ton code
          #              (Remplace ton ancien "rm: true" de façon sécurisée)
          ARGS: "-rltgoDzvO --delete"